<Window x:Class="DataLens.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DataLens"
        mc:Ignorable="d"
        Title="DataLens - MySQL DB Viewer" Height="600" Width="1000"
        MinHeight="400" MinWidth="700"
        Icon="assets/app_icon.ico"
        WindowState="Maximized"
        Background="#FAFAFA">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="#E8E8E8" Padding="12,10" BorderBrush="#DDD" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Workspace:" VerticalAlignment="Center" Margin="0,0,8,0" FontWeight="SemiBold"/>
                <ComboBox x:Name="CboWorkspace" Width="220" MinWidth="180" Height="28"
                          SelectionChanged="CboWorkspace_SelectionChanged"/>
                <Button x:Name="BtnConnect" Content="Connect" Width="80" Height="28" Margin="12,0,0,0"
                        Click="BtnConnect_OnClick"/>
                <Button x:Name="BtnDisconnect" Content="Disconnect" Width="80" Height="28" Margin="4,0,0,0"
                        Click="BtnDisconnect_OnClick" IsEnabled="False"/>
                <Separator Margin="16,0" Width="1" Background="#BBB"/>
                <Button x:Name="BtnNewWorkspace" Content="New workspace" Width="110" Height="28" Margin="0,0,4,0"
                        Click="BtnNewWorkspace_OnClick"/>
                <Button x:Name="BtnEditWorkspace" Content="Edit workspace" Width="110" Height="28"
                        Click="BtnEditWorkspace_OnClick"/>
            </StackPanel>
        </Border>

        <TabControl Grid.Row="1" Margin="8" Background="Transparent" BorderThickness="0">
            <TabItem Header="Objects">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="260" MinWidth="200"/>
                        <ColumnDefinition Width="6"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="6"/>
                        <ColumnDefinition Width="200" MinWidth="160"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Background="White" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4" Padding="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock x:Name="TxtObjectsConnectionInfo" Grid.Row="0" Margin="12,10,12,4" Foreground="#555" FontSize="12" TextWrapping="Wrap" Text="Not connected"/>
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="12,4,12,8">
                                <TextBlock Text="Database objects" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="#333"/>
                                <Button x:Name="BtnRefreshObjects" Content="Refresh" Margin="8,0,0,0" Padding="6,2" IsEnabled="False" Click="BtnRefreshObjects_Click" ToolTip="Reload tables and stored procedures"/>
                                <Button x:Name="BtnReconnect" Content="Reconnect" Margin="4,0,0,0" Padding="6,2" IsEnabled="False" Click="BtnReconnect_Click" ToolTip="Disconnect and connect again"/>
                            </StackPanel>
                            <TreeView x:Name="TreeObjects" Grid.Row="2" Margin="8,0,8,8"
                                      SelectedItemChanged="TreeObjects_SelectedItemChanged"
                                      MouseDoubleClick="TreeObjects_MouseDoubleClick"
                                      BorderThickness="0" Background="Transparent">
                                <TreeView.Resources>
                                    <HierarchicalDataTemplate DataType="{x:Type local:TreeNodeItem}" ItemsSource="{Binding Children}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding DisplayText}" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </HierarchicalDataTemplate>
                                </TreeView.Resources>
                            </TreeView>
                        </Grid>
                    </Border>

                    <GridSplitter Grid.Column="1" Width="6" HorizontalAlignment="Stretch" Background="Transparent"/>

                    <Border Grid.Column="2" Background="White" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4" Padding="0">
                        <Grid Margin="12,0,12,12">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Button x:Name="BtnSaveQueryBuilder" Grid.Row="0" Content="Save query builder" Height="26" Padding="8,0" Margin="0,0,0,8" HorizontalAlignment="Left" Click="BtnSaveQueryBuilder_OnClick"/>
                            <TabControl x:Name="QueryBuilderTabs" Grid.Row="1" Visibility="Collapsed"/>
                            <TextBlock x:Name="TxtPlaceholder" Grid.Row="1" Text="Select a table from the tree to open a query builder tab. Select a stored procedure to open its definition in a tab."
                                       Margin="12" Foreground="#999" TextWrapping="Wrap" VerticalAlignment="Center" HorizontalAlignment="Center" TextAlignment="Center"/>
                        </Grid>
                    </Border>

                    <GridSplitter Grid.Column="3" Width="6" HorizontalAlignment="Stretch" Background="Transparent"/>

                    <Border Grid.Column="4" Background="#F8F8F8" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4" Padding="0">
                        <Grid Margin="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,8,0,8">
                                <TextBlock Text="Saved query builders" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="#333"/>
                                <Button x:Name="BtnDuplicateSavedQueryBuilder" Content="Duplicate" Margin="8,0,0,0" Padding="8,2" Click="BtnDuplicateSavedQueryBuilder_Click"/>
                                <Button x:Name="BtnDeleteSavedQueryBuilder" Content="Delete" Margin="4,0,0,0" Padding="8,2" Click="BtnDeleteSavedQueryBuilder_Click"/>
                            </StackPanel>
                            <ListBox x:Name="SavedQueryBuildersListBox" Grid.Row="1" DisplayMemberPath="Name"
                                     SelectionChanged="SavedQueryBuildersListBox_SelectionChanged"
                                     MouseDoubleClick="SavedQueryBuildersListBox_MouseDoubleClick"/>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <TabItem Header="Query">
                <Grid Margin="0,8,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="200" MinHeight="120"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Border Grid.Row="0" Background="#F0F0F0" Padding="12,8" Margin="0,0,0,4" CornerRadius="4">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Saved query:" VerticalAlignment="Center" Margin="0,0,8,0" FontWeight="SemiBold"/>
                            <ComboBox x:Name="CboSavedQuery" Width="200" MinWidth="120" Height="26"
                                      DisplayMemberPath="Name" SelectionChanged="CboSavedQuery_SelectionChanged"/>
                            <Button x:Name="BtnLoadQuery" Content="Load" Width="60" Height="26" Margin="8,0,0,0" Click="BtnLoadQuery_OnClick"/>
                            <Button x:Name="BtnSaveQuery" Content="Save" Width="60" Height="26" Margin="4,0,0,0" Click="BtnSaveQuery_OnClick"/>
                            <Button x:Name="BtnDeleteQuery" Content="Delete" Width="60" Height="26" Margin="4,0,0,0" Click="BtnDeleteQuery_OnClick"/>
                        </StackPanel>
                    </Border>
                    <Border Grid.Row="1" Background="#F0F0F0" Padding="12,8" Margin="0,0,0,4" CornerRadius="4">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Saved filter:" VerticalAlignment="Center" Margin="0,0,8,0" FontWeight="SemiBold"/>
                            <ComboBox x:Name="CboSavedFilter" Width="200" MinWidth="120" Height="26"
                                      DisplayMemberPath="Name"/>
                            <Button x:Name="BtnInsertFilter" Content="Insert" Width="60" Height="26" Margin="8,0,0,0" Click="BtnInsertFilter_OnClick"/>
                            <Button x:Name="BtnSaveFilter" Content="Save" Width="60" Height="26" Margin="4,0,0,0" Click="BtnSaveFilter_OnClick"/>
                            <Button x:Name="BtnDeleteFilter" Content="Delete" Width="60" Height="26" Margin="4,0,0,0" Click="BtnDeleteFilter_OnClick"/>
                        </StackPanel>
                    </Border>
                    <Border Grid.Row="2" Background="#F5F5F5" Padding="12,6" Margin="0,0,0,4" CornerRadius="4">
                        <StackPanel>
                            <TextBlock Text="Tables (click to insert name into query):" FontWeight="SemiBold" Margin="0,0,0,4" Foreground="#333"/>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" MaxHeight="36">
                                <ItemsControl x:Name="QueryTablesItemsControl">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel Orientation="Horizontal"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Content="{Binding}" Margin="0,0,6,4" Padding="8,4" Click="QueryTable_OnClick" Tag="{Binding}"
                                                    ToolTip="Click to insert table name into query"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>
                    <TextBlock Grid.Row="3" Text="SQL (Ctrl+Enter to run)" FontWeight="SemiBold" Margin="12,8,12,4" Foreground="#333"/>
                    <TextBox x:Name="TxtQuery" Grid.Row="4" Margin="12,0,12,8"
                             FontFamily="Consolas" FontSize="14" Padding="10"
                             AcceptsReturn="True" TextWrapping="NoWrap" VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto" KeyDown="TxtQuery_KeyDown"/>
                    <StackPanel Grid.Row="5" Orientation="Horizontal" Margin="12,0,12,4">
                        <Button x:Name="BtnRunQuery" Content="Run" Width="80" Height="28" Click="BtnRunQuery_OnClick"/>
                        <TextBlock x:Name="TxtQueryStatus" VerticalAlignment="Center" Margin="12,0,0,0" Foreground="#666"/>
                    </StackPanel>
                    <TextBlock Grid.Row="6" Text="Last run query" FontWeight="SemiBold" Margin="12,4,12,4" Foreground="#333"/>
                    <Grid Grid.Row="7" Margin="12,0,12,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="TxtLastRunQuery" Grid.Column="0" IsReadOnly="True" FontFamily="Consolas" FontSize="12"
                                 Padding="8,6" TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"
                                 BorderBrush="#CCC" BorderThickness="1" Background="#F9F9F9" MinHeight="44" Margin="0,0,6,0"/>
                        <Button x:Name="BtnCopyQueryTab" Grid.Column="1" Width="36" Height="36" Padding="0" ToolTip="Copy query to clipboard"
                                Click="BtnCopyQueryTab_OnClick" VerticalAlignment="Top">
                            <TextBlock Text="ðŸ“‹" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Button>
                    </Grid>
                    <Border Grid.Row="8" Background="White" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4" Padding="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock x:Name="TxtQueryResultTitle" Text="Results" FontWeight="SemiBold" Margin="12,10,12,4" Foreground="#666"/>
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="12,0,12,8">
                                <Button x:Name="BtnExportQueryCsv" Content="Export CSV" Width="90" Height="26" Margin="0,0,6,0" Click="BtnExportQueryCsv_Click"/>
                                <Button x:Name="BtnExportQueryJson" Content="Export JSON" Width="90" Height="26" Margin="0,0,6,0" Click="BtnExportQueryJson_Click"/>
                                <Button x:Name="BtnEditQueryRow" Content="Edit selected row" Width="130" Height="26" Click="BtnEditQueryRow_Click"/>
                            </StackPanel>
                            <Grid Grid.Row="2" Margin="12,0,12,12">
                                <DataGrid x:Name="DataGridQuery" Visibility="Collapsed"
                                          AutoGenerateColumns="True" IsReadOnly="False"
                                          CanUserAddRows="False" CanUserDeleteRows="False"
                                          CanUserReorderColumns="True" CanUserResizeRows="False"
                                          SelectionMode="Extended" SelectionUnit="FullRow"
                                          HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                          AlternatingRowBackground="#F9F9F9" RowHeight="28"
                                          CellEditEnding="DataGridQuery_CellEditEnding"/>
                                <TextBlock x:Name="TxtQueryMessage" Visibility="Collapsed" Margin="12" Foreground="#333" TextWrapping="Wrap"/>
                                <TextBlock x:Name="TxtQueryPlaceholder" Text="Connect to a workspace and run a query to see results."
                                           Margin="12" Foreground="#999" TextWrapping="Wrap"/>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
        </TabControl>

        <Border x:Name="StatusBorder" Grid.Row="2" HorizontalAlignment="Stretch"
                Background="#E0E0E0" Padding="12,6" Visibility="Collapsed">
            <TextBlock x:Name="TxtStatus" Text="" Foreground="#333"/>
        </Border>
    </Grid>
</Window>
